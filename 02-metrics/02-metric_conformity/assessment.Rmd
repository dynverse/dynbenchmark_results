---
title: "assessment"
params:
  assessment: NULL
---

```{r}
rule_ix <- which(rules$id == assessment$rule_id)
rule <- dynutils::extract_row_to_list(rules, rule_ix)
```

### `r rule$name`

\begin{center}
```{r, out.width="2in", out.height="10in", dpi = 300}
knitr::include_graphics(rule$image_location)
```

\end{center}

`r render_equations(rule$description)`

A metric conforms to this rule if: `r render_equations(paste0("$", rule$conforms_if, "$"))`

```{r}
assessment$conformity %>% 
  select(metric_id, conforms) %>% 
  arrange(metric_id) %>% 
  mutate(
    metric_id = label_metrics(metric_id, format = "latex") %>% as.character() %>% forcats::fct_inorder(),
    conforms = kableExtra::cell_spec(
      ifelse(conforms, "\U2714", "\U2716"), 
      background = ifelse(conforms, "#2ECC40", "#FF4136"),
      format = "latex"
    )
  ) %>% 
  spread(metric_id, conforms) %>% 
  knitr::kable(format = "latex", escape = FALSE) %>% 
  kableExtra::kable_styling() %>% 
  kableExtra::row_spec(0, hline_after = FALSE)
```

`r rule$observation`

```{r, results = "asis"}
width <- ifelse(is.null(assessment$plot_datasets$width), 10, assessment$plot_datasets$width)
height <- ifelse(is.null(assessment$plot_datasets$height), 10, assessment$plot_datasets$height)
add_fig(
  assessment$plot_datasets,
  paste0(rule$id, "_plot_datasets"),
  "Example dataset(s) for this rule",
  width = width,
  height = height
)
```


```{r, results = "asis"}
width <- ifelse(is.null(assessment$plot_scores$width), 10, assessment$plot_scores$width)
height <- ifelse(is.null(assessment$plot_scores$height), 10, assessment$plot_scores$height)
add_fig(
  assessment$plot_scores,
  paste0(rule$id, "_plot_scores"),
  "Example dataset(s) for this rule",
  width = width,
  height = height
)
```


\pagebreak
